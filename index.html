<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="IFchanged" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="IFchanged">
<meta property="og:url" content="http://ifchanged.io/index.html">
<meta property="og:site_name" content="IFchanged">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IFchanged">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ifchanged.io/"/>





  <title> IFchanged </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-99172222-1', 'auto');
  ga('send', 'pageview');
</script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IFchanged</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2017/第一站经验总结——行为驱动开发（BDD）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/第一站经验总结——行为驱动开发（BDD）/" itemprop="url">
                  简谈行为驱动开发(BDD)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T00:45:44+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/第一站经验总结——行为驱动开发（BDD）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/第一站经验总结——行为驱动开发（BDD）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>BDD（Behaviour-Driven Development行为驱动开发）是一种敏捷开放方式，鼓励开发者、测试、业务方参与开发协作，虽然多数情况下只有开发和测试参与。BDD使用自然语言描述用户故事，从而让各方都可读、可写测试用例，并且用通用的语言精确描述软件的行为。</p>
<h3 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h3><p>一种测试方案，模拟用户的真实行为，来保证各个软件模块执行后的最终结果是正确的。</p>
<h2 id="运作方式"><a href="#运作方式" class="headerlink" title="运作方式"></a>运作方式</h2><h3 id="文件组织"><a href="#文件组织" class="headerlink" title="文件组织"></a>文件组织</h3><p>用Gherkin语法描述step，一个个关联且有序的step组成完整的scenario，相关的scenario放入一个feature文件中。</p>
<h3 id="Gherkin语法"><a href="#Gherkin语法" class="headerlink" title="Gherkin语法"></a>Gherkin语法</h3><ul>
<li>Given：把系统置为某种状态，也就是准备数据</li>
<li>When：描述用户行为，也就是要测试的step</li>
<li>Then：获得结果，通常用于校验</li>
<li>And：表示使用上一个step的关键词</li>
</ul>
<h3 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h3><p>用tag来标记不同模块，也用tag来标记通过和未通过的scenario</p>
<h3 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h3><p>令人怀念的<code>behave -kt @xxx</code>命令</p>
<h3 id="Jenkins执行"><a href="#Jenkins执行" class="headerlink" title="Jenkins执行"></a>Jenkins执行</h3><p>可用Jenkins输出完整报告。在Jenkins执行时可用tag或目录分割多组feature，则并行执行，理论最短时间为最长scenario的耗时。</p>
<p>参考：</p>
<ul>
<li><a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then" target="_blank" rel="external">Gherkin</a></li>
<li><a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then" target="_blank" rel="external">Given When Then</a></li>
</ul>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>以用户故事为测试单位，保证软件在真实、连贯场景中的正确性。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>当业务越来复杂、微服务越来越多时，这种集成测试方案难以维护，对开发者要求较高。在没有良好并行方案时，速度很慢。</p>
<h2 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h2><ul>
<li>库：behave，其他Python库实现：Lettuce、radish</li>
<li>处理异步：celery使用同步模式、异步消息消费者采用子进程阻塞调用</li>
<li>夸服务调用：BDD SERVER，使用http服务器传递step，并使用sub step调用，用http response返回结果</li>
<li>第三方服务：各种mock</li>
<li>IDE支持：Pycharm</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2017/git-tag应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/git-tag应用/" itemprop="url">
                  git tag应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-28T14:59:13+08:00">
                2017-02-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/git-tag应用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/git-tag应用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Tag概述"><a href="#1-Tag概述" class="headerlink" title="1. Tag概述"></a>1. Tag概述</h2><blockquote>
<p>像其他版本控制系统（VCS）一样，Git 可以给历史中的某一个提交打上标签，以示重要。 比较有代表性的是人们会使用这个功能来标记发布结点（v1.0 等等）。</p>
</blockquote>
<p>参考：  </p>
<ul>
<li><a href="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE" target="_blank" rel="external">https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE</a></li>
<li><code>git help tag</code></li>
</ul>
<h3 id="1-1-命令"><a href="#1-1-命令" class="headerlink" title="1.1 命令"></a>1.1 命令</h3><p>tag的命令与分支相似。</p>
<ul>
<li>列出标签: <code>git tag</code></li>
<li>创建标签: <code>git tag tag123</code><ul>
<li>附注标签: <code>git tag -a v1.4 -m &#39;my version 1.4&#39;</code></li>
<li>打在制定版本: <code>git tag -a v1.2 9fceb02</code> </li>
</ul>
</li>
<li>查看标签内容: <code>git show v1.4</code> 或 <code>git log v1.4</code><ul>
<li>按照版本排序：<code>git tag --sort=&quot;version:refname</code></li>
<li>搜索： <code>git tag -l &lt;pattern&gt;</code>，如<code>git tag -l &quot;v*&quot;</code></li>
</ul>
</li>
<li>push标签：git push不会推送本地标签<ul>
<li>push特定标签： <code>git push origin [tagname]</code></li>
<li>push所有标签： <code>git push origin --tags</code></li>
</ul>
</li>
<li>检出标签: <code>git checkout -b version2 v2.0.0</code></li>
<li>删除标签：<ul>
<li>删除本地标签: <code>git tag -d v0.1</code>      批量：<code>git tag -l &quot;vTEST*&quot;|xargs git tag -d</code></li>
<li>删除远程标签: <code>git push origin --delete v0.1</code>   批量：<code>git tag -l &quot;vTEST*&quot;|xargs git push origin --delete</code></li>
</ul>
</li>
</ul>
<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><h3 id="2-1-jenkins"><a href="#2-1-jenkins" class="headerlink" title="2.1 jenkins"></a>2.1 jenkins</h3><p>增加构建后操作的Publisher：</p>
<p><img src="/images/git_tag1.png" alt=""></p>
<ul>
<li>v168形式的标签表示每次 jenkins上线构建的版本,使用<code>git tag --sort=&quot;version:refname&quot; -l &quot;v*&quot;</code>获得按照版本排序的tag。</li>
</ul>
<h3 id="2-2-Gitlab"><a href="#2-2-Gitlab" class="headerlink" title="2.2 Gitlab"></a>2.2 Gitlab</h3><p>需要添加jenkins用户为develop权限。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ol>
<li>比较</li>
</ol>
<ul>
<li>文件比较：<code>git diff v98 master</code>,此命令比较v98和master文件不同。常用于比较两个版本是否一致。</li>
<li><p>commit：<code>git diff ^v98 master</code>，此命令比较不在v98上但是在master上的commit有哪些。常用于比较两个版本不同的commit</p>
<ul>
<li><p>取得远程master上没有上线的commit：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git fetch &amp;&amp; git log `git <span class="keyword">tag</span> <span class="title">--sort</span>=<span class="string">"version:refname"</span> -l <span class="string">"v*"</span>|tail -<span class="number">1</span>`..origin/<span class="literal">master</span></div></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git fetch &amp;&amp; git rev-list ^`git <span class="keyword">tag</span> <span class="title">--sort</span>=<span class="string">"version:refname"</span> -l <span class="string">"v*"</span>|tail -<span class="number">1</span>` origin/<span class="keyword">master</span> <span class="title">--pretty</span>=oneline</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>注</strong>：<code>--sort=&quot;version:refname&quot; -l &quot;v*&quot;</code>要求v开头的tag都是jenkins打出来的，且要求git 2.1及以上版本</p>
<ol>
<li>回滚</li>
</ol>
<p>todo</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2016/git mater分支回滚指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/git mater分支回滚指南/" itemprop="url">
                  git master分支回滚指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-24T23:44:27+08:00">
                2016-08-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/git mater分支回滚指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/git mater分支回滚指南/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><h3 id="1-1-master分支回滚的特殊性"><a href="#1-1-master分支回滚的特殊性" class="headerlink" title="1.1 master分支回滚的特殊性"></a>1.1 master分支回滚的特殊性</h3><ol>
<li>多人协作，修改提交历史的方式易造成冲突</li>
<li>希望所有操作的记录都是保存的，避免丢失代码</li>
<li>希望没有master权限的人也能按照正常合并流程进行回滚</li>
</ol>
<p>所以，以下的方法都是不会修改提交历史了，操作可以使用正常合并流程。</p>
<h3 id="1-2-场景描述"><a href="#1-2-场景描述" class="headerlink" title="1.2 场景描述"></a>1.2 场景描述</h3><ol>
<li>回滚某个或某些commit</li>
<li>回滚分支合并（merge commit）</li>
<li>回滚<strong>到</strong>某个提交</li>
</ol>
<h2 id="2-回滚方法"><a href="#2-回滚方法" class="headerlink" title="2. 回滚方法"></a>2. 回滚方法</h2><h3 id="2-1-回滚某个或某些commit"><a href="#2-1-回滚某个或某些commit" class="headerlink" title="2.1 回滚某个或某些commit"></a>2.1 回滚某个或某些commit</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">git</span> <span class="keyword">revert </span>commit</div></pre></td></tr></table></figure>
<p>如：<code>git revet 08096c7</code></p>
<h3 id="2-2-回滚分支合并（merge-commit）"><a href="#2-2-回滚分支合并（merge-commit）" class="headerlink" title="2.2 回滚分支合并（merge commit）"></a>2.2 回滚分支合并（merge commit）</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git revert -m parent-<span class="built_in">number</span> commit</div></pre></td></tr></table></figure>
<p>如<code>git revert -m 1 08096c7c71429ac044a90bbd43f67aef13a91102</code></p>
<p>一个典型的merge commit：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">commit a4aebedf433805eb15767f6f1905f3c236ce48bd</div><div class="line"><span class="symbol">Merge:</span> <span class="number">6</span>ee7688 d593ca7</div><div class="line"><span class="symbol">Author:</span> XXX <span class="params">&lt;XXX@qq.com&gt;</span></div><div class="line"><span class="symbol">Date:</span>   Mon Aug <span class="number">22</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">16</span> <span class="number">2016</span> +<span class="number">0800</span></div><div class="line"></div><div class="line">    XXXXX</div></pre></td></tr></table></figure></p>
<p>其中merge字段中的6ee7688 d593ca7就是两个parent commit，<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">      a4aebedf4</div><div class="line">         /\</div><div class="line"> 6ee7688|<span class="string"> </span>|d593ca7</div><div class="line">(master)|<span class="string"> </span>|<span class="string"> (feature)</span></div><div class="line">        |<span class="string"> </span>|</div><div class="line">        |<span class="string"> </span>|</div></pre></td></tr></table></figure></p>
<p>-m 参数指定要回滚到parent commit，值为1或2，即第1个还是第2个。如上图，我们想回滚<strong>掉</strong>feature分之，回<strong>到</strong>合并之前的master，则选择1.通常使用Gitlab的merge request合并的分之都选1.</p>
<h3 id="2-3-回滚到某个提交"><a href="#2-3-回滚到某个提交" class="headerlink" title="2.3 回滚到某个提交"></a>2.3 回滚到某个提交</h3><p>如要把master回滚到tag v100:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">reset</span> <span class="comment">--hard v100</span></div><div class="line">git <span class="keyword">reset</span> <span class="comment">--soft origin/master</span></div><div class="line">git <span class="keyword">commit</span> -am <span class="string">"revert to v100"</span></div></pre></td></tr></table></figure></p>
<p>回滚完毕后，可以使用<code>git diff head v100</code>比较是否还有不同，如果有不同，则说明操作错误。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2016/peewee-note2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/peewee-note2/" itemprop="url">
                  peewee笔记(2)——构建自已的peewee文档
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-28T20:17:01+08:00">
                2016-03-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/peewee-note2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/peewee-note2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>开源软件的一大好处就是我们可以根据自己的需要进行定制或优化，但这带来的问题是，修改可能无法合并的回社区。随着时间流逝，自己的版本可能和官方版本差别越来越大，也无法合并官方的代码更新。如果后续开发者一直阅读官方文档就会有问题，所有需要构建自己的文档。</p>
<p>打开peewee官方文档<a href="http://docs.peewee-orm.com/en/latest/" target="_blank" rel="external">http://docs.peewee-orm.com/en/latest/</a>，我们可以看到只提供latest、stable版本文档，可能和我们定制的已经千差万别。好在peewee文档使用Sphinx构建，易于修改部署。</p>
<h2 id="部署文档"><a href="#部署文档" class="headerlink" title="部署文档"></a>部署文档</h2><p>好在github上我们可以找到历史版本的文档，以2.6.4为例。</p>
<ol>
<li>安装Sphinx：<code>pip install sphinx</code></li>
<li>从官方git（<a href="https://github.com/coleifer/peewee" target="_blank" rel="external">https://github.com/coleifer/peewee</a>）下载peewee源码并切换到tag 2.6.4。</li>
<li>进入项目内doc/目录，执行<code>make.bat html</code>(Windows)或<code>make html</code>(Linux)生成静态网站目录_build/index/ 。</li>
<li>把2的目录找个服务器放。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2016/peewee-note1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/peewee-note1/" itemprop="url">
                  peewee笔记(1)——基本语法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-23T10:44:27+08:00">
                2016-03-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/peewee-note1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/peewee-note1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="peewee使用指南"><a href="#peewee使用指南" class="headerlink" title="peewee使用指南"></a>peewee使用指南</h1><p>本系列文章基于peewee 2.6.4，同时会参照Django Orm做点比较。</p>
<h2 id="1-peewee介绍"><a href="#1-peewee介绍" class="headerlink" title="1.peewee介绍"></a>1.peewee介绍</h2><p>peewee是一个轻量级Python ORM，支持Sqlite、MYSQL、PostgresqlD等数据库。</p>
<h2 id="2-使用指南"><a href="#2-使用指南" class="headerlink" title="2.使用指南"></a>2.使用指南</h2><h3 id="2-1-连接mysql"><a href="#2-1-连接mysql" class="headerlink" title="2.1.连接mysql"></a>2.1.连接mysql</h3><h4 id="2-1-1-连接形式"><a href="#2-1-1-连接形式" class="headerlink" title="2.1.1.连接形式"></a>2.1.1.连接形式</h4><p>使用url连接，方式和django类似，如：<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'mysql'</span>,</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'name'</span>,</div><div class="line">        <span class="string">'USER'</span>: <span class="string">'user'</span>,                      </div><div class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'pass'</span>,                  </div><div class="line">        <span class="string">'HOST'</span>: <span class="string">'url'</span>,</div><div class="line">        <span class="string">'PORT'</span>: <span class="string">''</span>,</div><div class="line">        <span class="string">'CONN_MAX_AGE'</span>: <span class="number">100</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2-2-model定义"><a href="#2-2-model定义" class="headerlink" title="2.2.model定义"></a>2.2.model定义</h3><h4 id="2-2-1-概述"><a href="#2-2-1-概述" class="headerlink" title="2.2.1.概述"></a>2.2.1.概述</h4><p>一句话描述：<strong>和Django一样用。</strong></p>
<p>model定义基本和Django一致，<br>需要注意的是：</p>
<ol>
<li>属性和Django基本一致</li>
<li>有些Django并不影响使用的东西peewee不支持，目前注意到的是<code>Field.choices</code>。</li>
<li>peewee可以使用<code>playhouse.signals</code>实现信号机制。</li>
</ol>
<p>详见：<a href="http://docs.peewee-orm.com/en/stable/peewee/models.html#fields" target="_blank" rel="external">http://docs.peewee-orm.com/en/stable/peewee/models.html#fields</a></p>
<h2 id="3-ORM操作（CRUD）"><a href="#3-ORM操作（CRUD）" class="headerlink" title="3.ORM操作（CRUD）"></a>3.ORM操作（CRUD）</h2><p>示例Model：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> peewee <span class="keyword">import</span> *</div><div class="line"></div><div class="line">db = SqliteDatabase(<span class="string">'people.db'</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(Model)</span>:</span></div><div class="line">    name = CharField(default=<span class="string">''</span>)</div><div class="line">    age = IntegerField(default=<span class="number">0</span>) </div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        database = db <span class="comment"># This model uses the "people.db" database.</span></div></pre></td></tr></table></figure>
<p>注：这是个model示例，实际上’database=db’已经封装在<code>db.model.Model</code>中，在python-service-base中不用写。</p>
<h3 id="3-1-增加（Create）"><a href="#3-1-增加（Create）" class="headerlink" title="3.1.增加（Create）"></a>3.1.增加（Create）</h3><ol>
<li>create()方法：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grandma =Person.create(name=<span class="string">'Grandma'</span>, age = <span class="number">1</span>)</div></pre></td></tr></table></figure>
<ol>
<li>save()方法</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">person = Person()</div><div class="line">person.name = <span class="string">'bill'</span></div><div class="line">person.age =<span class="number">10</span></div><div class="line">person.save()</div></pre></td></tr></table></figure>
<h3 id="3-2-查（Retrieve）"><a href="#3-2-查（Retrieve）" class="headerlink" title="3.2.查（Retrieve）"></a>3.2.查（Retrieve）</h3><p>peewee中查询记录分为get（查询单条记录）、select(条件查询批量记录)。</p>
<h4 id="3-2-1-查询单条记录"><a href="#3-2-1-查询单条记录" class="headerlink" title="3.2.1.查询单条记录"></a>3.2.1.查询单条记录</h4><p>注：get方法获取不存在的记录会抛出异常。</p>
<ol>
<li><p><code>Product.get(name=&#39;abc&#39;)</code><br>或者<br><code>Product.get(Product.name==&#39;abc&#39;)</code></p>
</li>
<li><p><code>Product.select().where(Product.name==&#39;abc&#39;).get()</code></p>
</li>
<li><code>Product.select().where(Product.name==&#39;abc&#39;).first()</code></li>
</ol>
<p><strong>注:</strong></p>
<ol>
<li>get()支持name=’abc’也支持Product.name==’abc’的写法，where<strong>只</strong>Product.name==’abc’。</li>
<li>前两种都是get方法，查询不到会抛出异常，select方法查询不到返回None。</li>
</ol>
<h4 id="3-2-2-查询全部"><a href="#3-2-2-查询全部" class="headerlink" title="3.2.2.查询全部"></a>3.2.2.查询全部</h4><p><code>Product.select()</code>等价于Django中的<code>Product.select().all()</code>，返回一个可迭代的SelectQuery对象。</p>
<h4 id="3-2-3-条件查询"><a href="#3-2-3-条件查询" class="headerlink" title="3.2.3.条件查询"></a>3.2.3.条件查询</h4><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Product</span>.<span class="keyword">select</span>().<span class="keyword">where</span>(<span class="built_in">Product</span>.<span class="keyword">name</span>==<span class="string">'abc'</span>)</div></pre></td></tr></table></figure>
<p>返回一个可迭代的SelectQuery对象。</p>
<ul>
<li>或(OR)查询：<strong>|</strong>，例如：<code>User.select().where((User.is_staff == True) | (User.is_superuser == True))</code></li>
<li>且(AND)查询:<strong>&amp;</strong>，例如：<code>Product.select().where(Product.name==&#39;abc&#39;,Product.owner_id==10086)</code> 或者 <code>Product.select().where((Product.name==&#39;abc&#39;) &amp; (Product.owner_id==10086))</code></li>
<li>非(NOT)：<strong>~</strong>,没用过。。。</li>
<li><p>比较：peewee支持如下比较符</p>
  <figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">==  x <span class="keyword">equals</span> y</div><div class="line">&lt;   x <span class="keyword">is</span> <span class="keyword">less than</span> y</div><div class="line">&lt;=  x <span class="keyword">is</span> <span class="keyword">less than or equal</span> <span class="keyword">to</span> y</div><div class="line">&gt;   x <span class="keyword">is</span> <span class="keyword">greater than</span> y</div><div class="line">&gt;=  x <span class="keyword">is</span> <span class="keyword">greater than</span> <span class="keyword">or</span> <span class="keyword">equal</span> <span class="keyword">to</span> y</div><div class="line">!=  x <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">equal</span> <span class="keyword">to</span> y</div><div class="line">&lt;&lt;  x IN y, <span class="keyword">where</span> y <span class="keyword">is</span> a <span class="built_in">list</span> <span class="keyword">or</span> query</div><div class="line">&gt;&gt;  x IS y, <span class="keyword">where</span> y <span class="keyword">is</span> None/NULL</div><div class="line">%   x LIKE y <span class="keyword">where</span> y may <span class="keyword">contain</span> wildcards</div><div class="line">**  x ILIKE y <span class="keyword">where</span> y may <span class="keyword">contain</span> wildcards</div><div class="line">~   Negation</div></pre></td></tr></table></figure>
</li>
<li><p>其他查询</p>
  <figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">.contains(substr) 	Wild-card search <span class="keyword">for</span> substring.</div><div class="line">.startswith(prefix) 	Search <span class="keyword">for</span> values beginning <span class="keyword">with</span> prefix.</div><div class="line">.endswith(suffix) 	Search <span class="keyword">for</span> values ending <span class="keyword">with</span> suffix.</div><div class="line">.between(low, high) 	Search <span class="keyword">for</span> values between low <span class="keyword">and</span> high.</div><div class="line">.regexp(exp) 	Regular expression match.</div><div class="line">.bin_and(value) 	<span class="keyword">Binary</span> <span class="keyword">AND</span>.</div><div class="line">.bin_or(value) 	<span class="keyword">Binary</span> <span class="keyword">OR</span>.</div><div class="line">.in_(value) 	<span class="keyword">IN</span> lookup (identical <span class="keyword">to</span> &lt;&lt;).</div><div class="line">.not_in(value) 	<span class="keyword">NOT</span> <span class="keyword">IN</span> lookup.</div><div class="line">.is_null(is_null) 	<span class="keyword">IS</span> NULL <span class="keyword">or</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> NULL. Accepts <span class="built_in">boolean</span> param.</div><div class="line">.concat(other) 	Concatenate two strings <span class="keyword">using</span> ||.</div></pre></td></tr></table></figure>
</li>
</ul>
<p>示例：</p>
<p>查询id in ids，ids是个list。</p>
<ul>
<li><code>Product.select().where(Product.id &lt;&lt; ids)</code></li>
<li><code>Product.select().where(Product.id.in_(ids))</code></li>
</ul>
<p>等价于Django中的<code>Product.objects.filter(id__=ids)</code>。</p>
<h4 id="3-2-3-计数count"><a href="#3-2-3-计数count" class="headerlink" title="3.2.3.计数count"></a>3.2.3.计数count</h4><p><code>Product.select().where(Product.name==&#39;abc&#39;).count()</code>。<br>SelectQuery对象并不支持len()方法，即执行<code>len(Product.select().where(Product.name==&#39;abc&#39;))</code>会抛出TypeError异常。虽然可以实现支持len，但滥用可能带来性能风险。</p>
<h4 id="3-2-5-排序order-by"><a href="#3-2-5-排序order-by" class="headerlink" title="3.2.5.排序order_by"></a>3.2.5.排序order_by</h4><ul>
<li>降序：使用”-“或者”desc()”,<code>Tweet.select().order_by(Tweet.created_date.desc())</code> 等价于 <code>Tweet.select().order_by(-Tweet.created_date)</code></li>
<li>升序：使用”+”或者”asc()”或者不写，<code>User.select().order_by(+User.username)</code></li>
</ul>
<h3 id="3-3-删除（Delete）"><a href="#3-3-删除（Delete）" class="headerlink" title="3.3.删除（Delete）"></a>3.3.删除（Delete）</h3><p><strong>建议使用方法1</strong></p>
<ol>
<li>Model.delete (Python class method, in API Reference)<br><code>mall_models.Order.delete().where(mall_models.Order.id=order.id).execute()</code><br>或者<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = mall_models.Order.delete().where(mall_models.Order.id=order.id)</div><div class="line">p.execute()</div></pre></td></tr></table></figure>
</li>
</ol>
<p>也就是执行了execute()才会执行删除操作。</p>
<ol>
<li><p>Model.delete_instance (Python method, in API Reference)</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">p</span> = Product.get(Product.name==<span class="string">'abc'</span>)</div><div class="line"><span class="selector-tag">p</span>.elete_instance()</div></pre></td></tr></table></figure>
</li>
<li><p>DeleteQuery<br><code>dq = DeleteQuery(User).where(User.active == False).execute()</code></p>
</li>
</ol>
<h3 id="3-4-改（Update）"><a href="#3-4-改（Update）" class="headerlink" title="3.4.改（Update）"></a>3.4.改（Update）</h3><ol>
<li>update修改(推荐)<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">query = Stat.update(counter=Stat.counter + <span class="number">1</span>).where(Stat.url == request.url)</div><div class="line">query.execute()</div></pre></td></tr></table></figure>
</li>
</ol>
<p>同delete,也就是执行了execute()才会执行update操作。</p>
<ol>
<li>save修改<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> stat <span class="keyword">in</span> Stat.select().where(Stat.url == request.url):</div><div class="line">     stat.counter += <span class="number">1</span></div><div class="line">     stat.save()</div></pre></td></tr></table></figure>
</li>
</ol>
<p>两种方式都类似Django语句，<strong>需要特别注意的是，peewee的update是原子的（Atomic ）</strong>，在并发情况下可靠，即peewee的update语句效果等价于Django使用F表达式的update，如<code>rules.update(remained_count=F(&#39;remained_count&#39;) - 1, get_count=F(&#39;get_count&#39;) + 1)</code></p>
<h2 id="4-外键与join"><a href="#4-外键与join" class="headerlink" title="4.外键与join"></a>4.外键与join</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderHasProduct</span><span class="params">(models.Model)</span>:</span></div><div class="line">	order = models.ForeignKey(Order)</div><div class="line">	product = models.ForeignKey(Product, related_name=<span class="string">'product'</span>)</div><div class="line">	price = models.FloatField()  <span class="comment"># 商品单价</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span><span class="params">(models.Model)</span>:</span></div><div class="line">	order_id = models.CharField(max_length=<span class="number">100</span>)  <span class="comment"># 订单号</span></div><div class="line">	webapp_user_id = models.IntegerField()  <span class="comment"># WebApp用户的id</span></div><div class="line">	webapp_id = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">'店铺ID'</span>)  <span class="comment"># webapp,订单成交的店铺id</span></div><div class="line">	webapp_source_id = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">'商品来源店铺ID'</span>)  <span class="comment"># 订单内商品实际来源店铺的id，已废弃</span></div><div class="line">	buyer_name = models.CharField(max_length=<span class="number">100</span>)  <span class="comment"># 购买人姓名</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span><span class="params">(models.Model)</span>:</span></div><div class="line">	owner = models.ForeignKey(User, related_name=<span class="string">'user-product'</span>)</div><div class="line">	name = models.CharField(max_length=<span class="number">256</span>)  <span class="comment"># 商品名称</span></div><div class="line">	physical_unit = models.CharField(default=<span class="string">''</span>, max_length=<span class="number">256</span>)  <span class="comment"># 计量单位</span></div><div class="line">	price = models.FloatField(default=<span class="number">0.0</span>)  <span class="comment"># 商品价格</span></div></pre></td></tr></table></figure>
<p>OrderHasProduct有外键Product和外键Order。</p>
<h3 id="4-1-外键赋值"><a href="#4-1-外键赋值" class="headerlink" title="4.1.外键赋值"></a>4.1.外键赋值</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mall_models.OrderHasProduct.create(</div><div class="line">	<span class="keyword">order</span>=<span class="built_in">self</span>.db_model,</div><div class="line">	product=product.id,</div><div class="line">	<span class="params">...</span></div></pre></td></tr></table></figure>
<p>可以看到把<strong>外键实例</strong>或者<strong>外键实例的id</strong>都是可以的。</p>
<h3 id="4-2-涉及外键的查询"><a href="#4-2-涉及外键的查询" class="headerlink" title="4.2.涉及外键的查询"></a>4.2.涉及外键的查询</h3><h4 id="4-2-1-根据外键的主键查询"><a href="#4-2-1-根据外键的主键查询" class="headerlink" title="4.2.1 根据外键的主键查询"></a>4.2.1 根据外键的主键查询</h4><p>直接<code>OrderHasProduct.select().where(where(mall_models.Order.id=order.id).product_id=10086)</code></p>
<h4 id="4-2-2-根据外键的某字段查询（join外键）"><a href="#4-2-2-根据外键的某字段查询（join外键）" class="headerlink" title="4.2.2 根据外键的某字段查询（join外键）"></a>4.2.2 根据外键的某字段查询（join外键）</h4><figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="type">Rule</span>(<span class="title">models</span>.<span class="type">Model</span>):</span></div><div class="line">	owner = models.<span class="type">ForeignKey</span>(<span class="type">User</span>)</div><div class="line">	name = models.<span class="type">CharField</span>(<span class="title">max_length</span>=20, <span class="title">db_index</span>=<span class="type">True</span>) </div><div class="line">	valid = models.<span class="type">DecimalField</span>(<span class="title">max_digits</span>=65) </div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="type">Card</span>(<span class="title">models</span>.<span class="type">Model</span>):</div><div class="line">	owner = models.<span class="type">ForeignKey</span>(<span class="type">User</span>)</div><div class="line">	rule = models.<span class="type">ForeignKey</span>(<span class="type">Rule</span>)</div></pre></td></tr></table></figure>
<p>Card有外键Rule。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">count = Card.select().join(wzcard_models.Rule).where(Card<span class="selector-class">.card_id</span><span class="selector-class">.in_</span>(ids),Rule<span class="selector-class">.valid</span> &gt;<span class="number">0</span>).count()</div></pre></td></tr></table></figure>
<p>的确很长，peewee不支持django风格的”__”（双下划线），所以就直街上join了，peewee默认使用INNER join。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2016/emoji、Python、MySQL utf8mb4与UTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/emoji、Python、MySQL utf8mb4与UTF/" itemprop="url">
                  emoji、Python、MySQL utf8mb4与UTF
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-20T21:16:31+08:00">
                2016-03-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/emoji、Python、MySQL utf8mb4与UTF/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/emoji、Python、MySQL utf8mb4与UTF/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>编码、字符集是很大的内容，本文简单聊聊Python、MySQL中处理emoji这种特殊字符的问题。本文描述的Python是2.x版本，3.x情况可能有所不同</p>
<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>如果向MySQL utf8的表中保存一个emoji字符，必然出错，因为emoji是4字节字符，而MySQL utf8只支持3字节字符。MySQL 5.5开始加入utf8mb4支持4字节字符，但是又带来了显示的问题，毕竟PC上无法正常显示emoji的，而且能显示的系统又各家有各家的样子。所以要么把emoji过滤掉、要么在显示时候做特殊处理。</p>
<h2 id="浅谈UTF"><a href="#浅谈UTF" class="headerlink" title="浅谈UTF"></a>浅谈UTF</h2><p>最常用的字符都在BMP（Basic Multilingual Plane, 基本多语言平面），范围是<strong>U+0000至U+FFFF</strong>。只有这些码位在UCS-2可用，也是MySQL UTF8可以存储的范围，其它字符存储在辅助平面。</p>
<p>其中从<strong>U+D800到U+DFFF</strong>之间的码位区段是永久保留不映射到Unicode字符。UTF-16就利用保留下来的0xD800-0xDFFF区段的码位来对辅助平面的字符的码位进行编码。Unicode规定这个范围不对应字符，但在使用UCS-2时会被用于映射某些字符。</p>
<h2 id="MySQL对4字节字符的支持"><a href="#MySQL对4字节字符的支持" class="headerlink" title="MySQL对4字节字符的支持"></a>MySQL对4字节字符的支持</h2><p>MySQL 5.5开始有了utf8mb4字符集，兼容utf8并且可以存储4字节字符，详见<a href="https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html" target="_blank" rel="external">https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html</a></p>
<h2 id="Python中的4字节字符"><a href="#Python中的4字节字符" class="headerlink" title="Python中的4字节字符"></a>Python中的4字节字符</h2><p>最开始的方案是直接识别4字节字符并直接过滤掉，3字节的范围是<code>\u0000-\uFFFF</code>，如果想直接判断一个字符是否在这个范围，<strong>可能</strong>会惊奇的发现一个字符被拆分成了两个字符，该字符的长度也是<strong>2</strong>。比如<code>\U0001f604</code>(笑脸表情，参见<a href="https://codepoints.net/U+1F604" target="_blank" rel="external">https://codepoints.net/U+1F604</a>)会被拆分成<code>\ud83d</code>和<code>\ude04</code>，<code>\U0001f604</code>展示了以一当二的能力。至于说可能，是因为这是由Python解释器编译时候编译选项是–enable-unicode=ucs4还是–enable-unicode=ucs2决定的，后者就是前文描述的情况。查看当前Python情况可以输出sys.maxunicode，得到65535就是ucs2，详见Python文档<a href="https://docs.python.org/2/library/sys.html#sys.maxunicode" target="_blank" rel="external">https://docs.python.org/2/library/sys.html#sys.maxunicode</a> 。ucs4下，4字节字符范围在<code>\U00010000-\U0010ffff</code>，usc2下拆分出的两个字符会在\uD800-\uDFFF范围。所以如果要过滤emoji或者其他特殊字符，可以根据此范围替换。</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">filter_invalid_str</span><span class="params">(text)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	过滤非BMP字符</div><div class="line">	"""</div><div class="line">	<span class="keyword">try</span>:</div><div class="line">		<span class="comment"># UCS-4</span></div><div class="line">		highpoints = re.compile(<span class="string">u'[\U00010000-\U0010ffff]'</span>)</div><div class="line">	<span class="keyword">except</span> re.error:</div><div class="line">		<span class="comment"># UCS-2</span></div><div class="line">		highpoints = re.compile(<span class="string">u'[\uD800-\uDBFF][\uDC00-\uDFFF]'</span>)</div><div class="line"></div><div class="line">	<span class="keyword">return</span> highpoints.sub(<span class="string">u'_'</span>, text)</div></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="external">https://en.wikipedia.org/wiki/UTF-16</a></li>
<li><a href="https://docs.python.org/2/library/sys.html#sys.maxunicode" target="_blank" rel="external">https://docs.python.org/2/library/sys.html#sys.maxunicode</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html" target="_blank" rel="external">https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html</a></li>
<li><a href="http://stackoverflow.com/questions/26568722/remove-unicode-emoji-using-re-in-python" target="_blank" rel="external">http://stackoverflow.com/questions/26568722/remove-unicode-emoji-using-re-in-python</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2015/git技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/git技巧/" itemprop="url">
                  git技巧
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-23T10:44:27+08:00">
                2015-11-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/git技巧/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/git技巧/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>git技巧，不断更新中</p>
<ol>
<li><p>查找分支某个commit: </p>
<ol>
<li><code>git log|grep commitID</code></li>
<li><code>git branch --contains commitID</code> 可以配合grep指定分支</li>
</ol>
</li>
<li><p>比较分支不同的commit<br> <code>git rev-list A ^B</code>查找在B但不在A分支的commit</p>
</li>
<li><p>查找分支开发起点<br> <code>git rev-list A ^B|tail -1</code> B分支从A分支checkout出后的开发起点</p>
</li>
<li><p>查找不同commit数<br> <code>git rev-list A ^B --conut</code></p>
</li>
<li><p>强制更新本地分支到远程状态</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git fetch</div><div class="line">git <span class="built_in">reset</span> --hard <span class="built_in">origin</span>/master</div></pre></td></tr></table></figure>
</li>
</ol>
<p>或<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git fetch</div><div class="line">git checkout origin/<span class="keyword">master</span> <span class="title">-B</span> <span class="literal">master</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2015/git笔记-撤销与回滚/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/git笔记-撤销与回滚/" itemprop="url">
                  git笔记-撤销与回滚
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-19T11:31:25+08:00">
                2015-11-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/git笔记-撤销与回滚/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/git笔记-撤销与回滚/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-撤销"><a href="#1-撤销" class="headerlink" title="1.撤销"></a>1.撤销</h2><h3 id="撤销文件修改"><a href="#撤销文件修改" class="headerlink" title="撤销文件修改"></a>撤销文件修改</h3><p>checkout以文件作为参数时会<strong>修改</strong>文件为指定版本的状态。</p>
<ul>
<li>撤销未暂存的文件：<code>git checkout hello.py</code>，<code>git checkout .</code>为所有未暂存文件</li>
<li>撤销未commit的文件：<code>git checkout HEAD hello.py</code></li>
<li>撤销已经commit的文件到指定版本，如e316e21：<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git checkout e316e21 t1<span class="selector-class">.txt</span></div><div class="line">git add t1<span class="selector-class">.txt</span></div><div class="line">git commit -m <span class="string">'恢复t1.txt到e316e21'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注</strong>：以上撤销不会改写commit记录</p>
<h3 id="1-1-撤销commit（不改写commit记录）"><a href="#1-1-撤销commit（不改写commit记录）" class="headerlink" title="1.1 撤销commit（不改写commit记录）"></a>1.1 撤销commit（不改写commit记录）</h3><p>revert命令用新的commit来撤销修改，不改写提交记录。</p>
<ul>
<li>revert指定commit:<code>git revert e316e21</code></li>
<li><p>revert多个commit:<br>下文的大写字母带走commitID<br>方案1： 撤销多个commit并生成多个revert commit:<code>git revert A B C</code><br>方案2：撤销多个commit并生成一个revert commit：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git</span> revert A B C --<span class="literal">no</span>-commit</div><div class="line">git commit -m <span class="string">'the commit message'</span></div></pre></td></tr></table></figure>
</li>
<li><p>revert指定范围：<code>git revert A..D</code></p>
</li>
</ul>
<h3 id="1-2-撤销commit（改写commit记录）"><a href="#1-2-撤销commit（改写commit记录）" class="headerlink" title="1.2 撤销commit（改写commit记录）"></a>1.2 撤销commit（改写commit记录）</h3><p>使用reset或者rebase可以改写记录，但是要注意的是一旦改写，commit将会消失，并且会和远程分支、他人的本地分支冲突，push时需要用参数<code>-f</code>强制提交。所以，除非你清楚的知道重写的作用以及对他人带来的影响，不要轻易重写记录。</p>
<h4 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h4><p><code>git rebase -i commitID</code> commitID只要撤销的commit之前的一个或者某个commit<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">pick a5997c9 <span class="number">1</span></div><div class="line">pick <span class="number">88</span>a1edf <span class="number">2</span></div><div class="line">pick dfa8d09 <span class="number">3</span></div><div class="line">pick <span class="number">57</span>d2c26 <span class="number">4</span></div><div class="line">pick ff3451d <span class="number">5</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta"># Rebase dfa8d09..ff3451d onto dfa8d09 (2 command(s))</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># Commands:</span></div><div class="line"><span class="meta"># p, pick = use commit</span></div><div class="line"><span class="meta"># r, reword = use commit, but edit the commit message</span></div><div class="line"><span class="meta"># e, edit = use commit, but stop for amending</span></div><div class="line"><span class="meta"># s, squash = use commit, but meld into previous commit</span></div><div class="line"><span class="meta"># f, fixup = like "squash", but discard this commit's log message</span></div><div class="line"><span class="meta"># x, exec = run command (the rest of the line) using shell</span></div><div class="line"><span class="meta"># d, drop = remove commit</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># These lines can be re-ordered; they are executed from top to bottom.</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># If you remove a line here THAT COMMIT WILL BE LOST.</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># However, if you remove everything, the rebase will be aborted.</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># Note that empty commits are commented out</span></div></pre></td></tr></table></figure></p>
<p>参照git的提示，把要撤销的commit的action改为d，或者把正行删掉。</p>
<h4 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h4><p>如果这是要回滚到某个指定版本，如A，则直接<code>git reset A --hard</code>，如果要撤销的是提交记录中间的一个，则需要配合stash命令使用。<br>如有以下提交，要撤销其中的D提交，则：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">A</div><div class="line">B</div><div class="line"><span class="keyword">C</span></div><div class="line"><span class="keyword">D</span></div><div class="line"><span class="keyword">E</span></div></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">reset</span> <span class="comment">--soft D</span></div><div class="line">git stash</div><div class="line">git <span class="keyword">reset</span> <span class="comment">--hard E</span></div><div class="line">git stash pop</div><div class="line">git <span class="keyword">commit</span> -am 撤销D</div></pre></td></tr></table></figure>
<h3 id="1-3-撤销add"><a href="#1-3-撤销add" class="headerlink" title="1.3 撤销add"></a>1.3 撤销add</h3><p>当把某个文件add后，可以使用<code>git reset file_path</code>撤销add。</p>
<h3 id="1-4-撤销最近一次commit"><a href="#1-4-撤销最近一次commit" class="headerlink" title="1.4 撤销最近一次commit"></a>1.4 撤销最近一次commit</h3><p>有时候我们提交完了才发现漏掉了几个文件没有添加，或者提交信息写错了。 此时，可以运行带有 –amend 选项的提交命令尝试重新提交：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git <span class="keyword">commit</span> -m <span class="string">'initial commit'</span></div><div class="line">$ git <span class="keyword">add</span> forgotten_file</div><div class="line">$ git <span class="keyword">commit</span> <span class="comment">--amend</span></div></pre></td></tr></table></figure></p>
<p>第二次提交将会覆盖之前的提交。</p>
<h3 id="撤销（删除）未追踪的文件"><a href="#撤销（删除）未追踪的文件" class="headerlink" title="撤销（删除）未追踪的文件"></a>撤销（删除）未追踪的文件</h3><p><code>git clean -fdx</code></p>
<h2 id="2-版本回滚"><a href="#2-版本回滚" class="headerlink" title="2.版本回滚"></a>2.版本回滚</h2><p>版本回滚指把当前的分支切换到某个指定版本，具体而言是切换到某个commit或者tag，和上文提到的撤销类似，当从head开始撤销连续的若干commit就可达到回滚的效果。版本回滚是分支的角度，撤销是某个文件或者commit的角度。</p>
<p>如有以下提交，：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">A</div><div class="line">B</div><div class="line"><span class="keyword">C</span></div><div class="line"><span class="keyword">D</span></div><div class="line"><span class="keyword">E</span></div></pre></td></tr></table></figure></p>
<p>要回滚<strong>到D</strong>提交，有以下方法。</p>
<h3 id="2-1-revert回滚（不改写commit记录）"><a href="#2-1-revert回滚（不改写commit记录）" class="headerlink" title="2.1 revert回滚（不改写commit记录）"></a>2.1 revert回滚（不改写commit记录）</h3><p>revert回滚是唯一可以不修改commit记录的回滚方式，但是会产生一次revert commit。方法是上文讲到的<strong>revert多个commit</strong>。此时，要把D之后的提交全部revert。则：<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">git</span></span> revert D..HEAD --<span class="keyword">no</span>-commit</div><div class="line">git commit -am <span class="string">'revert to D'</span></div></pre></td></tr></table></figure></p>
<p>当不清楚范围是否制定正确的时候，可以使用<code>git revert D..HEAD</code>，与上面命令的区别是没有–no-commit参数，也不用最好再commit，git会自动的revert每一个commit并每个commit生成一个revert commit，这样就能看到revert了哪些commit。</p>
<h3 id="2-2-reset回滚（改写commit记录）"><a href="#2-2-reset回滚（改写commit记录）" class="headerlink" title="2.2 reset回滚（改写commit记录）"></a>2.2 reset回滚（改写commit记录）</h3><p>和撤销中的用法类似：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">reset</span> <span class="comment">--hard D</span></div></pre></td></tr></table></figure></p>
<h3 id="2-2-checkout回滚（改写提交记录）"><a href="#2-2-checkout回滚（改写提交记录）" class="headerlink" title="2.2 checkout回滚（改写提交记录）"></a>2.2 checkout回滚（改写提交记录）</h3><p>checkout有三个目标，checkout文件是撤销中提到的改写文件，checkout分支是常用的切换分支，checkout commit就会切换到该commit，结合切换分支就可以达到回滚分支的作用。<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git checkout D</span></div></pre></td></tr></table></figure></p>
<p>此时git会给出提示:</p>
<blockquote>
<p>You are in ‘detached HEAD’ state. You can look around, make experimental<br>changes and commit them, and you can discard any commits you make in this<br>state without impacting any branches by performing another checkout.</p>
</blockquote>
<p>简而言之，我们现在不在分支上，在’detached HEAD’ state（游离状态），当前的代码在commit D发生时的状态，<strong>此时的任何更改不会影响到任何分支</strong>。我们可以不回滚代码就可让代码处于之前的某个提交，查看之前的代码或者做些实验。</p>
<p>从游离状态退出的方法是checkout到某个分支，你如<code>git checkout master</code>。而如果用创建分支的方法checkout -b <branch_name>就可以从当前创建分支，结合强制创建分支的参数-B，checkout回滚分支可以概括为：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">git</span> checkout -<span class="keyword">B </span>test <span class="number">6</span>a26980</div></pre></td></tr></table></figure></branch_name></p>
<p>其中test是当前的分支名，6a26980是要回滚到的版本。</p>
<h3 id="2-3-本地分支回滚到远程分支"><a href="#2-3-本地分支回滚到远程分支" class="headerlink" title="2.3 本地分支回滚到远程分支"></a>2.3 本地分支回滚到远程分支</h3><p>当本地分支被改的乱七八糟时，你可能会想到重新拉取远程分支，一切重来。比较容易理解的方式可能是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git checkout -B master 随便切换个别的分支</div><div class="line">git branch -D <span class="built_in">test</span> 把糟糕的本地分支删掉</div><div class="line">git fetch 更新下远程引用分支</div><div class="line">git checkout <span class="built_in">test</span> 重新checkout <span class="built_in">test</span>分支</div></pre></td></tr></table></figure></p>
<p>这样子非常繁琐。有两个便捷的命令：<br><code>git checkout origin/test -B test</code>或者<code>git reset origin/test --hard</code>,当然，执行前别忘了<code>git fetch</code>更新。</p>
<h2 id="3-reflog"><a href="#3-reflog" class="headerlink" title="3.reflog"></a>3.reflog</h2><p>reflog记录了<strong>本地仓库</strong>的指针移动,使用<code>git reflog</code>查看,<code>git reflog --relative-date</code>可以查看到时间。，如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">b37132b HEAD@&#123;<span class="number">16</span> minutes ago&#125;: <span class="string">reset:</span> moving to origin/master</div><div class="line"><span class="number">94</span>a99ad HEAD@&#123;<span class="number">16</span> minutes ago&#125;: <span class="string">commit:</span> s</div><div class="line">b37132b HEAD@&#123;<span class="number">21</span> minutes ago&#125;: <span class="string">clone:</span> from git<span class="meta">@github</span>.<span class="string">com:</span>ladder1984/updateHosts</div></pre></td></tr></table></figure></p>
<p>上面的日志显示进行了reset操作，如果想恢复到reset之前的状态，可以使用<code>git reset 94a99ad --hard</code>命令。注意，reflog查看到的ID也是可以checkout命令的，所以也可以使用<code>git checkout 94a99ad -B master</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2015/git-rebase实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/git-rebase实践/" itemprop="url">
                  git rebase实践
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-28T19:54:15+08:00">
                2015-10-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/git-rebase实践/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/git-rebase实践/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="准备知识"><a href="#准备知识" class="headerlink" title="准备知识"></a>准备知识</h2><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><p>同一个分支有三种表现形式</p>
<ol>
<li>远程分支</li>
<li>远程引用分支 origin/master</li>
<li>本地分支    master</li>
</ol>
<p>fetch会更新远程引用分支，本地分支merge远程引用分支之后才会更新本地分支。</p>
<h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><p>pull实际执行了<code>git fetch</code>和<code>git merge FETCH_HEAD</code>两条指令</p>
<h3 id="rebase的意义"><a href="#rebase的意义" class="headerlink" title="rebase的意义"></a>rebase的意义</h3><p>rebase的作用是重写提交记录。</p>
<ul>
<li><p>rebase优点：</p>
<ol>
<li>合并commit（与前分支rebase）</li>
<li>避免merge commit（与master rebase）</li>
<li>重写提交记录</li>
</ol>
</li>
<li><p>rebase缺点：</p>
</li>
</ul>
<ol>
<li>操作不慎会丢失commit</li>
<li>影响不到的冲突（由merge commit引起）</li>
</ol>
<p>在操作不熟练时，可以先备份分支<code>checkout -b bak_xxx</code>。</p>
<p>merge+revert的方式可以保证代码的安全性，但提交记录混乱。rebase+reset的方式能够保证提交记录的清晰。</p>
<h2 id="新建分支"><a href="#新建分支" class="headerlink" title="新建分支"></a>新建分支</h2><h3 id="创建新的分支"><a href="#创建新的分支" class="headerlink" title="创建新的分支"></a>创建新的分支</h3><p>开始需求时，需要建立一个新分支，并把它推送到远程仓库。新建分支的方法多种多样，唯一的原则是从master新建分支。</p>
<ol>
<li>更新master<ol>
<li><code>git checkout master</code></li>
<li><code>git pull</code></li>
</ol>
</li>
<li>从master创建feature分支：<br> <code>git checkout master -b test</code> 或 <code>git checkout origin/master -b</code></li>
<li>推送分支当远程<br>  <code>git push -u origin test:test</code> 本地分支名在前<br> -u是–set-upstream-to 的简写，设置追踪分支。</li>
</ol>
<h3 id="拉取分支"><a href="#拉取分支" class="headerlink" title="拉取分支"></a>拉取分支</h3><p>其他人在此分支协作时的获取。<br>    <code>git checkout --track origin/test</code></p>
<h2 id="更新分支"><a href="#更新分支" class="headerlink" title="更新分支"></a>更新分支</h2><h3 id="从master更新"><a href="#从master更新" class="headerlink" title="从master更新"></a>从master更新</h3><ol>
<li><strong>方案1</strong><ol>
<li><code>git checkout master</code></li>
<li><code>git pull</code></li>
<li><code>git checkout test</code></li>
<li><code>git rebase master</code></li>
</ol>
</li>
<li><strong>方案2（推荐）</strong><br> <code>git pull --rebase origin master</code><br> <strong>注意：</strong>此种方法不会更新本地master分支</li>
</ol>
<h3 id="从test更新"><a href="#从test更新" class="headerlink" title="从test更新"></a>从test更新</h3><p><code>git pull --rebase</code><br><strong>注意</strong>：需要先设置跟踪分支</p>
<h2 id="完成后合并到master"><a href="#完成后合并到master" class="headerlink" title="完成后合并到master"></a>完成后合并到master</h2><p>在test分支开发<strong>完成</strong>后，需要通过rebase合并commit，此时rebase的目标不再是分支，而是在test分支中的commit。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol>
<li>从master更新test分支，方法见上文</li>
<li>寻找rebase点，使用<code>git log</code>查看test分支中最后一个commit，如<br>66fc050b </li>
<li><code>rebase -i 66fc050b</code>开始rebase</li>
</ol>
<h3 id="交互式rebase"><a href="#交互式rebase" class="headerlink" title="交互式rebase"></a>交互式rebase</h3><p>在执行rebase -i命令会打开sublime编辑器<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">pick <span class="number">66</span>fc050 Test:git pull --rebase origin <span class="keyword">master</span></div><div class="line"><span class="title">pick</span> a8b6d2f <span class="number">2</span></div><div class="line">pick c2c1903 xsas</div><div class="line"></div><div class="line"><span class="comment"># Rebase 749e319..c2c1903 onto 749e319 (3 command(s))</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Commands:</span></div><div class="line"><span class="comment"># p, pick = use commit</span></div><div class="line"><span class="comment"># r, reword = use commit, but edit the commit message</span></div><div class="line"><span class="comment"># e, edit = use commit, but stop for amending</span></div><div class="line"><span class="comment"># s, squash = use commit, but meld into previous commit</span></div><div class="line"><span class="comment"># f, fixup = like "squash", but discard this commit's log message</span></div><div class="line"><span class="comment"># x, exec = run command (the rest of the line) using shell</span></div><div class="line"><span class="comment"># d, drop = remove commit</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># These lines can be re-ordered; they are executed from top to bottom.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># However, if you remove everything, the rebase will be aborted.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note that empty commits are commented out</span></div></pre></td></tr></table></figure></p>
<p>内容以<code>动作 commitID commit信息</code>的形式展现，66fc050、a8b6d2f、c2c1903就是三次提交，如果需要合并三次提交，修改成<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pick <span class="number">66</span>fc050 Test:git pull --rebase origin <span class="keyword">master</span></div><div class="line"><span class="title">f</span> a8b6d2f <span class="number">2</span></div><div class="line">f c2c1903 xsas</div></pre></td></tr></table></figure></p>
<p>然后保存文件并退出sublime。</p>
<p>如果rebase过程中遇到冲突，解决完冲突后执行<code>git rebase --continue</code>，需要注意的是，即使强制关闭控制台，依然会处于rebase状态，需要执行<code>git rebase --abort</code>取消rebase，版本库会会滚刀rebase之前的状态。或者执行<code>git rebase --edit-todo</code>重新打开rebase文件。</p>
<p>如果产生冲突，rebase会逐个释放冲突，处理完冲突后，执行<code>git rebase --continue</code>继续。</p>
<h3 id="推送到远程仓库"><a href="#推送到远程仓库" class="headerlink" title="推送到远程仓库"></a>推送到远程仓库</h3><p>test分支经过rebase后，显然已经和远程分支冲突了，<br>需要强制提交:<br><code>git push -f</code><br>或者先删除远程分支:</p>
<ol>
<li><code>git push origin --delete test</code></li>
<li><code>git push origin test:test</code></li>
</ol>
<h3 id="管理员合并分支"><a href="#管理员合并分支" class="headerlink" title="管理员合并分支"></a>管理员合并分支</h3><p>最终由管理员把test分支合并到master，需要注意的是合并前需要把test分支从master分支rebase更新，避免merge commit。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="使用Sublime-Text作为外部文本编辑器"><a href="#使用Sublime-Text作为外部文本编辑器" class="headerlink" title="使用Sublime Text作为外部文本编辑器"></a>使用Sublime Text作为外部文本编辑器</h3><p>对git进行设置通常使用git config命令或者直接编辑.config文件</p>
<p><code>git config --global core.editor &quot;&#39;C:/Program Files/Sublime Text 2/sublime_text.exe&#39; -w&quot;</code><br>或<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[<span class="name">core</span>]</div><div class="line">	editor = <span class="symbol">'C:</span>\\Program Files\\Sublime Text <span class="number">2</span>\\sublime_text.exe' -w</div></pre></td></tr></table></figure></p>
<h3 id="rebase取代merge"><a href="#rebase取代merge" class="headerlink" title="rebase取代merge"></a>rebase取代merge</h3><p><code>git config --global branch.autosetuprebase always</code><br>或<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">[branch]</span></div><div class="line">	autosetuprebase = always</div></pre></td></tr></table></figure></p>
<h3 id="reset在合并提交中的应用"><a href="#reset在合并提交中的应用" class="headerlink" title="reset在合并提交中的应用"></a>reset在合并提交中的应用</h3><p><code>git reset commitId</code> commitId 的位置同rebase，reset会撤销提交，一切回滚到<code>git add</code>和<code>git commit</code>之前的状态，所以我们可以把所有修改一次commit，达到合并commit的作用。</p>
<p>需要注意的是，reset后，提交人信息和提交信息(commit msg)都会丢失。</p>
<h3 id="git-hooks-go"><a href="#git-hooks-go" class="headerlink" title="git_hooks_go"></a>git_hooks_go</h3><p>通过git hooks的方式为提交信息添加用户名、分支名等信息，方便rebase。<br>运行git_hooks_go目录下的install.py安装。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>从master创建分支</li>
<li>使用rebase更新</li>
<li>使用rebase -i 合并commit</li>
<li>管理员合并分支</li>
</ol>
<p>更新git：<br><a href="http://git-scm.com/download/" target="_blank" rel="external">http://git-scm.com/download/</a></p>
<p>git文档：</p>
<ol>
<li><a href="http://git-scm.com/book/zh/v2" target="_blank" rel="external">http://git-scm.com/book/zh/v2</a></li>
<li><a href="https://www.atlassian.com/git/tutorials/" target="_blank" rel="external">https://www.atlassian.com/git/tutorials/</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ifchanged.io/2015/使用页面可见性API-Visibility/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zeroten">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IFchanged">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/使用页面可见性API-Visibility/" itemprop="url">
                  使用页面可见性API Visibility
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-09-25T18:38:43+08:00">
                2015-09-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/使用页面可见性API-Visibility/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/使用页面可见性API-Visibility/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>可见性API的好处是判断当前页面是否可见，并基于此执行不同的操作，通常可以节省不少资源，比如轮询，比如视频播放。</p>
<p>可见性API包括两个属性<strong>document.hidden</strong>、<strong>document.visibilityState</strong>和一个事件<strong>visibilitychange</strong>。</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>HTML5扩展了document的接口，增加了<code>hidden</code>和<code>visibilityState</code>两个属性，它们的含义也比较接近。</p>
<p><code>hidden</code>返回一个布尔值，表示页面是否完全不可见。<code>visibilityState</code>表示可见状态，返回一个字符串，可能的返回值是<code>visible</code>、<code>hidden</code>、<code>prerender</code>、<code>uploaded</code>，具体含义可以看MDN的介绍<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API" target="_blank" rel="external">使用页面可见性API</a></p>
<p><code>visibilitychange</code>事件当页面可见性改变的时候会触发。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>结合两个属性和事件，可以很好的根据页面可见性进行一些操作，比如<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"visibilitychange"</span>, func, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(<span class="built_in">document</span>.visibilityState == <span class="string">'visible'</span>)&#123;  </div><div class="line">    <span class="comment">//do sth.</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">document</span>.visibilityState == <span class="string">'hidden'</span>)&#123;</div><div class="line">    <span class="comment">//do sth.</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>参考文档：</p>
<ul>
<li><a href="http://www.w3.org/TR/page-visibility/" target="_blank" rel="external">http://www.w3.org/TR/page-visibility/</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Events/visibilitychange" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/Events/visibilitychange</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API</a></li>
<li><a href="http://blogs.msdn.com/b/ie/archive/2011/07/08/using-pc-hardware-more-efficiently-in-html5-new-web-performance-apis-part-2.aspx" target="_blank" rel="external">http://blogs.msdn.com/b/ie/archive/2011/07/08/using-pc-hardware-more-efficiently-in-html5-new-web-performance-apis-part-2.aspx</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="zeroten" />
          <p class="site-author-name" itemprop="name">zeroten</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">84</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ladder1984" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zeroten</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://ifchanged.disqus.com/count.js" async></script>
    

    

  













  





  

  

  

  

</body>
</html>
